<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UDP High-Rate: UDP High-Rate C++ Server/Client</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">UDP High-Rate
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">UDP High-Rate C++ Server/Client </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> A high-performance UDP server/client in C++17 designed to sustain <b>≥100 kpps</b> (100,000 packets per second) on loopback or a capable NIC, serve <b>≥10 concurrent clients</b>, and include:</p><ul>
<li>End-to-end (E2E) demonstration script</li>
<li><b>GoogleTest</b> unit tests targeting <b>100% code coverage</b></li>
<li>UML diagrams (PlantUML + Mermaid) of design and flows</li>
<li>Optional <b>Prometheus metrics</b> → <b>Grafana</b> dashboard</li>
<li>Docker + docker-compose integration</li>
<li>Git commit plan script to create a clean incremental history</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;Target platform: Linux (x86_64). Uses Linux <code>recvmmsg/sendmmsg</code> for batching; falls back to <code>recvfrom/sendto</code> if unavailable.</p>
<p></p>
</blockquote>
<p>&mdash;</p>
<h1><a class="anchor" id="autotoc_md1"></a>
1) Quick Start</h1>
<div class="fragment"><div class="line">git clone &lt;this repo&gt; udp-highrate-cpp</div>
<div class="line">cd udp-highrate-cpp</div>
<div class="line">mkdir -p build &amp;&amp; cd build</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2"></a>
Run server</h2>
<div class="fragment"><div class="line"># Start server on UDP :9000, metrics on :9100</div>
<div class="line">./udp_server --port 9000 --metrics-port 9100 --batch 64</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Run 10 clients (each 10 kpps for 5s → ~100 kpps)</h2>
<div class="fragment"><div class="line"># From a second terminal</div>
<div class="line">for i in $(seq 1 10); do</div>
<div class="line">  ./udp_client --server 127.0.0.1 --port 9000 --pps 10000 --seconds 5 --payload 64 &amp;</div>
<div class="line">done</div>
<div class="line">wait</div>
</div><!-- fragment --><p>Server will print periodic stats. You can also curl metrics: </p><div class="fragment"><div class="line">curl -s http://127.0.0.1:9100/metrics</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md5"></a>
2) E2E Demo</h1>
<p>A helper script runs a self-contained demo on loopback:</p>
<div class="fragment"><div class="line">./tools/run_e2e_local.sh</div>
</div><!-- fragment --><p>It builds the project (Release), starts the server, launches 10 clients for 5 seconds, and asserts we hit <b>≥100 kpps</b> (averaged over the run). The server also tracks distinct clients.</p>
<blockquote class="doxtable">
<p>&zwj;Note: Achievable pps depends on hardware &amp; kernel settings. The script uses loopback and generous defaults, but you may need to tune sysctls (e.g. <code>rmem_max</code>, <code>wmem_max</code>) for very high rates on real NICs.</p>
<p></p>
</blockquote>
<p>&mdash;</p>
<h1><a class="anchor" id="autotoc_md6"></a>
3) Unit Tests &amp; 100% Coverage</h1>
<p>Build with coverage flags and run tests: </p><div class="fragment"><div class="line">cd build</div>
<div class="line">cmake -DENABLE_COVERAGE=ON -DCMAKE_BUILD_TYPE=Debug ..</div>
<div class="line">make -j</div>
<div class="line">ctest --output-on-failure</div>
<div class="line">../tools/run_coverage.sh</div>
</div><!-- fragment --><p>This uses <code>lcov</code>/<code>genhtml</code> and will <b>fail</b> if total line coverage &lt; 100%.</p>
<blockquote class="doxtable">
<p>&zwj;If your machine lacks internet, tests still compile if GoogleTest is installed system-wide and discoverable by CMake. Otherwise, use the provided <code>build_with_system_gtest.sh</code> helper or install dev packages.</p>
<p></p>
</blockquote>
<p>&mdash;</p>
<h1><a class="anchor" id="autotoc_md7"></a>
4) Design (UML)</h1>
<p>See <code>diagrams/</code> for PlantUML sources and Mermaid copies. GitHub renders Mermaid inline in this README excerpt:</p>
<div class="fragment"><div class="line">classDiagram</div>
<div class="line">  class UdpServer {</div>
<div class="line">    +start()</div>
<div class="line">    +stop()</div>
<div class="line">    -runLoop()</div>
<div class="line">    -handleBatch()</div>
<div class="line">    -updateStats()</div>
<div class="line">  }</div>
<div class="line">  class UdpClient {</div>
<div class="line">    +start()</div>
<div class="line">    +stop()</div>
<div class="line">    -runLoop()</div>
<div class="line">  }</div>
<div class="line">  class UdpSocket {</div>
<div class="line">    +bind()</div>
<div class="line">    +connect()</div>
<div class="line">    +recvBatch()</div>
<div class="line">    +sendBatch()</div>
<div class="line">  }</div>
<div class="line">  class Stats {</div>
<div class="line">    +incSent(n)</div>
<div class="line">    +incRecv(n)</div>
<div class="line">    +clients()</div>
<div class="line">    +toString()</div>
<div class="line">  }</div>
<div class="line">  UdpServer --&gt; UdpSocket</div>
<div class="line">  UdpClient --&gt; UdpSocket</div>
<div class="line">  UdpServer --&gt; Stats</div>
<div class="line">  UdpClient --&gt; Stats</div>
</div><!-- fragment --><p>Sequence (send/receive path):</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line">  participant C as UdpClient</div>
<div class="line">  participant S as UdpServer</div>
<div class="line">  C-&gt;&gt;S: UDP Payload {seq, ts, magic}</div>
<div class="line">  S-&gt;&gt;S: parse + update stats + client map</div>
<div class="line">  S--&gt;&gt;C: (optional echo)</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md9"></a>
5) Prometheus &amp; Grafana (Optional)</h1>
<p>The server exposes <code>/metrics</code> (text exposition format) over HTTP (default port <code>9100</code>). Sample metrics:</p><ul>
<li><code>udp_packets_received_total</code></li>
<li><code>udp_packets_sent_total</code></li>
<li><code>udp_unique_clients</code></li>
<li><code>udp_rx_bytes_total</code></li>
<li><code>udp_tx_bytes_total</code></li>
<li><code>udp_last_second_rate</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md10"></a>
Try with docker-compose (Prometheus + Grafana)</h2>
<div class="fragment"><div class="line">docker compose -f docker/docker-compose.yml up -d --build</div>
<div class="line"># Server container starts on :9000 &amp; metrics on :9100</div>
<div class="line"># Prometheus scrapes server; Grafana at :3000 (admin/admin)</div>
</div><!-- fragment --><p>A starter Grafana dashboard is in <code>tools/prom/grafana_dashboard.json</code>.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md12"></a>
6) Docker</h1>
<p><b>Build</b>: </p><div class="fragment"><div class="line">docker build -t udp-highrate:latest -f docker/Dockerfile .</div>
</div><!-- fragment --><p><b>Run server</b>: </p><div class="fragment"><div class="line">docker run --net=host --rm udp-highrate:latest \</div>
<div class="line">  /app/bin/udp_server --port 9000 --metrics-port 9100 --batch 64</div>
</div><!-- fragment --><p> <b>Run client(s)</b>: </p><div class="fragment"><div class="line">docker run --net=host --rm udp-highrate:latest \</div>
<div class="line">  /app/bin/udp_client --server 127.0.0.1 --port 9000 --pps 10000 --seconds 5 --payload 64</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>&zwj;<code>--net=host</code> is used for maximum UDP performance in local demos.</p>
<p></p>
</blockquote>
<p>&mdash;</p>
<hr  />
<h1><a class="anchor" id="autotoc_md14"></a>
7) CLI</h1>
<p><b>udp_server</b> </p><div class="fragment"><div class="line">--port &lt;u16&gt;           UDP listen port (default 9000)</div>
<div class="line">--batch &lt;int&gt;          recvmmsg/sendmmsg batch size (default 64)</div>
<div class="line">--metrics-port &lt;u16&gt;   HTTP metrics port (default 9100, 0=disabled)</div>
<div class="line">--echo                 Echo back payloads to sender (off by default)</div>
<div class="line">--reuseport            Enable SO_REUSEPORT for scaling with multiple server procs</div>
<div class="line">--verbose              Print per-second stats</div>
</div><!-- fragment --><p><b>udp_client</b> </p><div class="fragment"><div class="line">--server &lt;ip&gt;          Server IP (default 127.0.0.1)</div>
<div class="line">--port &lt;u16&gt;           Server port (default 9000)</div>
<div class="line">--pps &lt;int&gt;            Target packets per second (default 10000)</div>
<div class="line">--seconds &lt;int&gt;        Duration (default 5)</div>
<div class="line">--payload &lt;int&gt;        Payload bytes (default 64)</div>
<div class="line">--batch &lt;int&gt;          sendmmsg batch size (default 64)</div>
<div class="line">--id &lt;int&gt;             Client logical id (default 0)</div>
<div class="line">--verbose              Print per-second stats</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md16"></a>
8) Limitations (Pros/Cons)</h1>
<p><b>Pros</b></p><ul>
<li>High-throughput via Linux <code>recvmmsg/sendmmsg</code> batching</li>
<li>Minimal dependencies, portable C++17 fallback</li>
<li>Metrics ready for Prometheus/Grafana</li>
<li>Full unit test suite targeting <b>100% coverage</b></li>
</ul>
<p><b>Cons / Boundaries</b></p><ul>
<li>Designed/tested for Linux; Windows requires adaptation</li>
<li>Single-threaded server loop by default; scale by <code>--reuseport</code> (one server process per CPU or extend to threads)</li>
<li>E2E throughput target depends on loopback/NIC + sysctls (see <code>tools/tuning.md</code>)</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md18"></a>
9) Repo Structure</h1>
<div class="fragment"><div class="line">.</div>
<div class="line">├─ CMakeLists.txt</div>
<div class="line">├─ include/udp/*.hpp</div>
<div class="line">├─ src/*.cpp</div>
<div class="line">├─ tests/*.cpp</div>
<div class="line">├─ tools/</div>
<div class="line">│  ├─ run_e2e_local.sh</div>
<div class="line">│  ├─ run_coverage.sh</div>
<div class="line">│  ├─ build_with_system_gtest.sh</div>
<div class="line">│  └─ prom/{prometheus.yml,grafana_dashboard.json}</div>
<div class="line">├─ diagrams/*.puml</div>
<div class="line">├─ docker/{Dockerfile,docker-compose.yml}</div>
<div class="line">└─ .github/workflows/ci.yml</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md20"></a>
10) License</h1>
<p>MIT </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
